<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The residual-fit spread plot • tukeyedar</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The residual-fit spread plot">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tukeyedar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/polish.html">Median polish</a></li>
    <li><a class="dropdown-item" href="../articles/qq.html">The empirical QQ plot (and derived Tukey mean-difference plot)</a></li>
    <li><a class="dropdown-item" href="../articles/rfs.html">The residual-fit spread plot</a></li>
    <li><a class="dropdown-item" href="../articles/RLine.html">Resistant Line</a></li>
    <li><a class="dropdown-item" href="../articles/symqq.html">The symmetry QQ plot</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mgimond/tukeyedar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>The residual-fit spread plot</h1>
                        <h4 data-toc-skip class="author">Manuel
Gimond</h4>
            
            <h4 data-toc-skip class="date">2025-01-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mgimond/tukeyedar/blob/main/vignettes/rfs.Rmd" class="external-link"><code>vignettes/rfs.Rmd</code></a></small>
      <div class="d-none name"><code>rfs.Rmd</code></div>
    </div>

    
    
<style type="text/css">
.caption {
    text-align: center !important;
    color: darkgrey;
    font-style: italic;
}
.figcaption {
    text-align: center !important;
    color: darkgrey;
    font-style: italic;
}
</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <em>residual-fit spread plot</em> (rfs plot) is a plot first
introduced by William Cleveland designed to compare the variability
explained by a fitted model (such as group means for a univariate
analysis or a linear model for a bivariate analysis) to the variability
in the remaining residuals. It’s constructed as follows:</p>
<ul>
<li>A model is fitted to the data. This can be the fitted mean values
for multiple groups in a univariate analysis, or a fitted regression
line in a bivariate analysis.</li>
<li>The residuals are computed by subtracting the fitted values from the
original values.</li>
<li>The estimated values from the model are centered on zero by
subtracting, for example, the mean from the fitted values.</li>
<li>Side-by-side quantile plots are generated from both sets of
values.</li>
</ul>
<p>As such, an important assumption when creating an rfs plot is the
shared shape of the residual distribution across groups or all ranges of
an independent variable.</p>
<p>Let’s start with a simple batch of values, <span class="math inline">\(y\)</span>.</p>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-3-1.png" alt="Figure 1. A batch of 60 values with the mean value represented as a red point. The points are jittered about the x-axis to help visualize their distribution." width="230.4"><p class="caption">
Figure 1. A batch of 60 values with the mean value represented as a red
point. The points are jittered about the x-axis to help visualize their
distribution.
</p>
</div>
<p>An overarching objective in data analysis is to reduce data to some
summary that best characterizes the set of values. In this example, we
can use the batch’s mean value of 11.03 (red point in figure 1) as an
estimate of a typical value for <span class="math inline">\(y\)</span>.
This is a good first approximation as to what to expect as a “typical”
value for <span class="math inline">\(y\)</span>. But, not all values in
<span class="math inline">\(y\)</span> are exactly equal 11.03. There is
some variability around this estimate. The variability ranges from 9 to
13 for an overall range of about 4 <span class="math inline">\(y\)</span> units. This variability about the
fitted mean value is often characterized as the
<strong>residuals</strong>–the difference between the actual value and
the fitted value.</p>
<p>If we want to improve our estimation of a value in <span class="math inline">\(y\)</span> (i.e. to reduce the uncertainty in our
estimation of <span class="math inline">\(y\)</span>), we may want to
add a grouping variable to the dataset. In essence, we are adding
another <em>handle</em> to the data in the hopes of chipping away at the
variability that accompanies the estimate. Figure 2 shows the groups
each value in <span class="math inline">\(y\)</span> belongs to.</p>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-4-1.png" alt="Figure 2. Same batch of values split across three groups with each group's mean displayed as an orange point." width="220.8"><p class="caption">
Figure 2. Same batch of values split across three groups with each
group’s mean displayed as an orange point.
</p>
</div>
<p>Knowing what group an observation belongs to can generate one of
three completely different estimates of <span class="math inline">\(y\)</span> that range from about 10 to 12 units.
This reduces the uncertainty in our estimation of <span class="math inline">\(y\)</span> by about 2 units, which is an
improvement over our earlier model that generated just one estimate for
all observations. The range in residual values about each fitted mean
seems to have also diminished. Ideally, we want the variability
surrounding the fitted means to be as small as possible relative to the
range of fitted means. However, the jitter plot in Figure 2 is not very
effective in comparing the three spreads. A better plot is one that
limits the emphasis on the comparison between spreads in fitted values
and their residuals. Such a plot does away with the absolute values of
the fitted means and their residuals, instead, it centers both spreads
around <span class="math inline">\(0\)</span>. Another characteristic of
an ideal plot is to help quantify the relative difference in spreads
between the fitted values and the residuals. A good candidate for such a
plot is a side-by-side quantile plot of fitted values centered (roughly)
around zero on the left and the residual values centered on their
respective group fitted values. This gives us the rfs plot shown in
Figure 3.</p>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-5-1.png" alt="Figure 3. A residual-fit spread plot. Each observation is split between a quantile plot of fitted value minus group mean (left plot) and a quantile plot of residuals (right plot). The x-axis displays the fraction of values (f-value) in each plot that are at or below the matching value on the y-axis." width="480"><p class="caption">
Figure 3. A residual-fit spread plot. Each observation is split between
a quantile plot of fitted value minus group mean (left plot) and a
quantile plot of residuals (right plot). The x-axis displays the
fraction of values (f-value) in each plot that are at or below the
matching value on the y-axis.
</p>
</div>
<p>What looks to be three horizontal lines on the left plot in Figure 3
are simply overlapping points–one point for each observation. Since an
observation in <span class="math inline">\(y\)</span> falls into one of
the three groups (<code>a</code>, <code>b</code> or <code>c</code>),
many values in <span class="math inline">\(y\)</span> will share the
same fitted (mean) value. For example, the last observation in the
original dataset has a value of <code>11.05</code> and is part of group
<code>c</code>. Its value can be decomposed into its group mean of
<code>11.98</code> and its residual of <code>-0.93</code> as
follows:</p>
<p><span class="math display">\[
11.05 = 11.98 - 0.93
\]</span></p>
<p>This value is shown as a green point in Figure 4. Note that the
overall mean of 11.03 is removed from the fitted value of 11.98 giving
us a rescaled fitted value of 0.95. The same process is applied to all
other observations resulting in the same number of points in both
quantile plots as total number of observations in the original
dataset.</p>
<div class="float">
<img src="rfs_uni_1.png" alt="Figure 4. Example of how a fitted value and its residual are mapped to an rfs plot. The green point is an example of an observation highlighted in the text whose estimated value and residual are mapped to the rfs plot."><div class="figcaption">Figure 4. Example of how a fitted value and its
residual are mapped to an rfs plot. The green point is an example of an
observation highlighted in the text whose estimated value and residual
are mapped to the rfs plot.</div>
</div>
<p><cr></cr></p>
<p>The rfs plot facilitates the comparison of both spreads by sharing
the same y axis and by having both spreads centered on 0. In this
working example, the spreads are about identical suggesting that the
grouping variable <span class="math inline">\(groups\)</span> can help
explain some of the variability in the data.</p>
<p>To help develop an intuitive feel for the interpretation of the rfs
plot, we can explore two extreme scenarios. In this next scenario, we
assign groups to the values in <span class="math inline">\(y\)</span> in
such a way as to maximize the separation in each group (see Figure
5).</p>
<center>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-7-1.png" alt="Figure 5. An example of a dataset that exhibits a clear separation in grouped values of y." width="230.4"><p class="caption">
Figure 5. An example of a dataset that exhibits a clear separation in
grouped values of y.
</p>
</div>
</center>
<p>Figure 6 shows the matching rfs plot. Here, the spread in fitted
values is greater than the spread in residuals defined by its minimum
and maximum values. If we ignore the extreme values and focus solely on
the inner 90% of the residuals, we see that the variability is reduced
to just about 1 unit in <span class="math inline">\(y\)</span> or half
the spread defined by the fitted values.</p>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-8-1.png" alt="Figure 6. The spread in the fitted mean values spans 2 units along the y-axis. The residuals span about 1 unit when ignoring the extreme values suggesting that the grouping variable does a good job in improving our estimation of y." width="480"><p class="caption">
Figure 6. The spread in the fitted mean values spans 2 units along the
y-axis. The residuals span about 1 unit when ignoring the extreme values
suggesting that the grouping variable does a good job in improving our
estimation of y.
</p>
</div>
<p>In this next example, we look at the other extreme: one where the
spread in fitted means is small relative to the variability surrounding
each fitted value. The original <span class="math inline">\(y\)</span>
batch of values is used while re-assigning the grouping variables in
such a way so as to minimize the importance of the grouping variable in
estimating <span class="math inline">\(y\)</span> (See Figure 7).</p>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-9-1.png" alt="Figure 7. An example of a dataset that does not exhibit a clear separation in grouped values of y." width="230.4"><p class="caption">
Figure 7. An example of a dataset that does not exhibit a clear
separation in grouped values of y.
</p>
</div>
<p>The matching rfs plot is shown in Figure 8.</p>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-10-1.png" alt="Figure 8. The spread in the fitted mean values spans just 1/3 of a unit while the residuals span about 3 units when ignoring the extreme values suggesting that the grouping variable does not improve on our estimation of y." width="480"><p class="caption">
Figure 8. The spread in the fitted mean values spans just 1/3 of a unit
while the residuals span about 3 units when ignoring the extreme values
suggesting that the grouping variable does not improve on our estimation
of y.
</p>
</div>
<p>With this last dataset, the spread in residuals is quite important
relative to the spread in fitted values. This suggests that the grouping
variable does not improve in our estimation of <span class="math inline">\(y\)</span>. Its effect in estimating <span class="math inline">\(y\)</span> is small. In other words, if we did
away with the grouping variable and used an overall mean value to
estimate <span class="math inline">\(y\)</span>, the spread in residuals
would be nearly identical.</p>
<div class="section level3">
<h3 id="generating-an-rfs-plot-with-eda_rfs">Generating an rfs plot with eda_rfs<a class="anchor" aria-label="anchor" href="#generating-an-rfs-plot-with-eda_rfs"></a>
</h3>
<p>The first dataset offered in the introduction can be recreated as
follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9591</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">11</span>, <span class="fl">12</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                 groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To generate an rfs plot, type:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mgimond.github.io/tukeyedar/">tukeyedar</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/eda_rfs.html">eda_rfs</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">y</span>, <span class="va">groups</span><span class="op">)</span></span>
<span><span class="co">#&gt;  The mid 90.0% of residuals covers about 1.62 units.</span></span>
<span><span class="co">#&gt;  The fitted values cover a range of 1.87 units, or about 115.4% of the mid 90.0% of residuals.</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-12-1.png" alt="Figure 9. An rfs plot generated using the eda_rfs() function." width="480"><p class="caption">
Figure 9. An rfs plot generated using the eda_rfs() function.
</p>
</div>
<p>In addition to generating a plot, the function will also output
information about the spreads in the console. It extracts the range of
values associated with the mid 90% of the residuals.</p>
<p>The plot and the console output indicate that the mid 90% of the
residuals cover a range of about 1.6 units, roughly. This is about 15%
less than the spread covered by the estimates.</p>
<p>The reason the mid 90% of values is chosen is to prevent outliers or
extreme values in the residuals from disproportionately exaggerating the
spread in residuals. For example, you’ll note an extreme outlier of a
little more than 1.5 units which is clearly not representative of the
bulk of the residuals.</p>
<p>A shaded region highlighting the inner 90% of residuals can be added
to the plot by setting <code>q = TRUE</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_rfs.html">eda_rfs</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">y</span>, <span class="va">groups</span>, q <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-13-1.png" alt="Figure 10. An rfs plot generated using the eda_rfs() function with the inner 90%  region displayed as a shaded region in the residuals quantile plot. The horizontal grey region shows the matching values on the y-axis." width="480"><p class="caption">
Figure 10. An rfs plot generated using the eda_rfs() function with the
inner 90% region displayed as a shaded region in the residuals quantile
plot. The horizontal grey region shows the matching values on the
y-axis.
</p>
</div>
<p>You can change what constitutes the mid portion of the residuals by
assigning a fraction ranging from 0 to 1 to the <code>inner</code>
argument. For example, if 95% of the inner residual spread is to be
compared to the spread in fitted values, set <code>inner = 0.95</code>
as shown in the following example.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_rfs.html">eda_rfs</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">y</span>, <span class="va">groups</span>, q <span class="op">=</span> <span class="cn">TRUE</span>, inner <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt;  The mid 95.0% of residuals covers about 1.92 units.</span></span>
<span><span class="co">#&gt;  The fitted values cover a range of 1.87 units, or about 97.3% of the mid 95.0% of residuals.</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-14-1.png" alt="Figure 11. An rfs plot generated using the eda_rfs() function with the inner 95% region displayed as a grey vertical region in the Residuals quantile plot. The horizontal grey region shows the matching values on the y-axis." width="480"><p class="caption">
Figure 11. An rfs plot generated using the eda_rfs() function with the
inner 95% region displayed as a grey vertical region in the Residuals
quantile plot. The horizontal grey region shows the matching values on
the y-axis.
</p>
</div>
<p>Adding the grouping variable improves our estimation of <span class="math inline">\(y\)</span> by reducing the uncertainty around our
estimate. Had we not split the data into groups and stuck with one
overall mean value, we would have ended up with a larger residual spread
as shown in Figure 12.</p>
<pre><code><span><span class="co">#&gt;  The mid 90.0% of residuals covers about 2.76 units.</span></span>
<span><span class="co">#&gt;  The fitted values cover a range of 0.00 units, or about 0.0% of the mid 90.0% of residuals.</span></span></code></pre>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-15-1.png" alt="Figure 12. An rfs plot of the data as it was presented to us before the data values were split into groups. The single fitted estimate is the overall mean." width="480"><p class="caption">
Figure 12. An rfs plot of the data as it was presented to us before the
data values were split into groups. The single fitted estimate is the
overall mean.
</p>
</div>
<p>In the above code, we added a new column with a unique grouping
value, <code>"all"</code>, shared across all <span class="math inline">\(y\)</span> values. This results in a single
“group” for the rfs spread plot. 90% of the inner residual spread covers
a range of 2.76 units–quite a bit more than the spread in residuals
observed when we added the grouping variable to the mix.</p>
</div>
<div class="section level3">
<h3 id="eda_rfs-options">eda_rfs() options<a class="anchor" aria-label="anchor" href="#eda_rfs-options"></a>
</h3>
<p>You’ve already been introduced to the <code>q</code> and
<code>inner</code> arguments which allows you to set and visualize the
inner range of the residual spread rfs plot and in the console.</p>
<p>Another <code>eda_rfs</code> option modifies the summary statistic
used with univariate data. By default, the function computes the mean
value for each group in the data. Instead, you can have the software
compute the median by setting <code>stat = median</code>. This can be a
useful option when working with skewed datasets. For example, the <span class="math inline">\(hp\)</span> variable in the built-in <span class="math inline">\(mtcars\)</span> dataset has a right skew. The
higher values will have a disproportionate influence on the mean value
as shown in Figure 13.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_rfs.html">eda_rfs</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">hp</span>, <span class="va">am</span>, q <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  The mid 90.0% of residuals covers about 177.90 units.</span></span>
<span><span class="co">#&gt;  The fitted values cover a range of 33.42 units, or about 18.8% of the mid 90.0% of residuals.</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-16-1.png" alt="Figure 13. An rfs plot of horsepower values in the mtcars dataset conditioned on transmission type (am variable in the dataset). Here, the mean statistic (default) is used to compute the central values." width="480"><p class="caption">
Figure 13. An rfs plot of horsepower values in the mtcars dataset
conditioned on transmission type (am variable in the dataset). Here, the
mean statistic (default) is used to compute the central values.
</p>
</div>
<p>Adopting the median will minimize the influence the extreme <span class="math inline">\(hp\)</span> values will have in fitting the
central values to each <span class="math inline">\(am\)</span> group as
shown in Figure 14.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_rfs.html">eda_rfs</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">hp</span>, <span class="va">am</span>, stat <span class="op">=</span> <span class="va">median</span>, q <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  The mid 90.0% of residuals covers about 187.15 units.</span></span>
<span><span class="co">#&gt;  The fitted values cover a range of 66.00 units, or about 35.3% of the mid 90.0% of residuals.</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-17-1.png" alt="Figure 14. An rfs plot of horsepower values in the mtcars dataset conditioned on transmission type (am variable in the dataset). Here, the optional median statistic is used to compute the central values." width="480"><p class="caption">
Figure 14. An rfs plot of horsepower values in the mtcars dataset
conditioned on transmission type (am variable in the dataset). Here, the
optional median statistic is used to compute the central values.
</p>
</div>
<blockquote>
<p>It’s important to remember that the use of an rfs plot only makes
sense when the residuals across all groups share the same distribution.
This is a common assumption with many popular parametric statistical
procedures.</p>
</blockquote>
<p>If skew is of concern in a univariate dataset, the function allows
for the transformation of the variable. For example, to render the
<code>hp</code> dataset more symmetrical, we can apply a log
transformation via the argument <code>p = 0</code> as shown in Figure
15.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_rfs.html">eda_rfs</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">hp</span>, <span class="va">am</span>,  q <span class="op">=</span> <span class="cn">TRUE</span>, p <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt;  The mid 90.0% of residuals covers about 1.28 units.</span></span>
<span><span class="co">#&gt;  The fitted values cover a range of 0.33 units, or about 25.7% of the mid 90.0% of residuals.</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-18-1.png" alt="Figure 15. An rfs plot of log transformed horsepower values in the mtcars dataset conditioned on transmission type (am variable in the dataset). Results are reported in the transformed variable units." width="480"><p class="caption">
Figure 15. An rfs plot of log transformed horsepower values in the
mtcars dataset conditioned on transmission type (am variable in the
dataset). Results are reported in the transformed variable units.
</p>
</div>
<p>The power transformation used with the data is displayed in the upper
right-hand side of the residual quantile plot. To hide the parameter
from the plot, set <code>show.par = FALSE</code>.</p>
<p>A stacked bar plot can be added to the plot to highlight the relative
spreads between fitted values and residuals. Note that the residual
spread is defined by the <code>inner</code> argument. To enable the bar
plot, set <code>bar</code> to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_rfs.html">eda_rfs</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">hp</span>, <span class="va">cyl</span>,  bar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  The mid 90.0% of residuals covers about 99.11 units.</span></span>
<span><span class="co">#&gt;  The fitted values cover a range of 126.58 units, or about 127.7% of the mid 90.0% of residuals.</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-19-1.png" alt="Figure 15. An rfs plot of log transformed horsepower values in the mtcars dataset conditioned on transmission type (am variable in the dataset). Results are reported in the transformed variable units." width="480"><p class="caption">
Figure 15. An rfs plot of log transformed horsepower values in the
mtcars dataset conditioned on transmission type (am variable in the
dataset). Results are reported in the transformed variable units.
</p>
</div>
<p>The red bar is the relative spread of the residuals and the green bar
is the relative spread of the fitted values. The stacked bar plot can be
helpful in quickly gauging the effect the fitted values have in
explaining the variability in the data. The longer the green bar
relative to the red bar, the greater the fitted value’s effect in
minimizing the uncertainty in the estimated value.</p>
</div>
<div class="section level3">
<h3 id="rfs-plots-for-bivariate-analysis">Rfs plots for bivariate analysis<a class="anchor" aria-label="anchor" href="#rfs-plots-for-bivariate-analysis"></a>
</h3>
<p>The rfs plot can be used with bivariate data to evaluate the effect a
fitted model such as a regression line may have in explaining the
variability in the data.</p>
<p>As is the case with univariate analysis, we are seeking an estimate
of a variable <span class="math inline">\(y\)</span> in such a way as to
minimize the uncertainty surrounding that estimate. For example, if we
want to estimate the miles-per-gallon consumed by a vehicle from the
<code>mtcars</code> built-in dataset, we could start with the simplest
estimate–that being the mean.</p>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-20-1.png" alt="Figure 16. A jitter plot of 32 miles-per-gallon measurements from the mtcars dataset. The mean value is fitted to the data giving us a first estimate of the variable." width="268.8"><p class="caption">
Figure 16. A jitter plot of 32 miles-per-gallon measurements from the
mtcars dataset. The mean value is fitted to the data giving us a first
estimate of the variable.
</p>
</div>
<p>There is, as expected, some variability that covers a range of about
24 miles-per-gallon.</p>
<p>We can improve on this estimate by adding another handle to the data.
But, instead of adding a categorical variable as was proposed in the
first example of this tutorial, we can add another <em>continuous</em>
variable to help us improve on this estimate. For example, we can see if
a vehicle’s horsepower can help us home in on a more precise estimate of
miles-per-gallon. Figure 17 gives us a scatter plot of miles-per-gallon
vs horsepower.</p>
<center>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/R.options-1.png" alt="Figure 17. A scatter plot of miles-per gallon (mpg) vs. horsepower (hp)." width="268.8"><p class="caption">
Figure 17. A scatter plot of miles-per gallon (mpg) vs. horsepower (hp).
</p>
</div>
</center>
<p>The pattern in the scatter plot suggests that <code>mpg</code>
decreases as a function of increasing <code>hp</code>.</p>
<p>We could split the data into sub-groups of <code>hp</code> values and
compute separate means as was done with the univariate example or, we
could fit a linear model to the data whereby the fitted line would
provide us with a unique estimate of <code>mpg</code> for any unique
value of <code>hp</code>. A common model fitting strategy is the
least-squares regression technique (see Figure 18).</p>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-21-1.png" alt="Figure 18. A scatter plot of miles-per-gallon (mpg) vs. horsepower (hp) with a fitted linear model. The vertical grey dashed lines highlight the error in the estimated values." width="268.8"><p class="caption">
Figure 18. A scatter plot of miles-per-gallon (mpg) vs. horsepower (hp)
with a fitted linear model. The vertical grey dashed lines highlight the
error in the estimated values.
</p>
</div>
<p>The estimate for <code>mpg</code> is <em>conditioned</em> on the
value of <code>hp</code>. The estimate (extracted from the red line in
the plot) ranges from about 7 miles-per-gallon to about 26
miles-per-gallon. The residuals are highlighted by the vertical dashed
lines in Figure 18. An rfs plot can help us assess how much of the
variability in <code>mpg</code> can be explained by this newly fitted
model and how it compares to the residuals (Figure 19).</p>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-22-1.png" alt="Figure 19. An rfs plot of the bivariate model whereby the fitted values are plotted on the left quantile plot and the residuals are plotted on the right quantile plot." width="480"><p class="caption">
Figure 19. An rfs plot of the bivariate model whereby the fitted values
are plotted on the left quantile plot and the residuals are plotted on
the right quantile plot.
</p>
</div>
<p>The fit-minus-mean plot looks different from a univariate rfs plot,
but its interpretation is the same. Each point in the left quantile plot
is the estimated <code>mpg</code> value (minus the overall mean) from
the fitted linear model. The points in the residuals quantile plot
represent the deviation, or error, in the estimated value from that of
each observation. For example, the estimated <code>mpg</code> value for
the largest <code>hp</code> value of <code>335</code> is
<code>7.24</code> and the residual is <code>+7.75</code> <code>hp</code>
units.</p>
<div class="float">
<img src="rfs_lm_1.png" alt="Figure 20. Example of how a fitted model and its residuals are mapped to an rfs plot. The red points on the fitted line represent the estimated values for all 32 observations in the mtcars dataset."><div class="figcaption">Figure 20. Example of how a fitted model and its
residuals are mapped to an rfs plot. The red points on the fitted line
represent the estimated values for all 32 observations in the mtcars
dataset.</div>
</div>
<p><cr></cr></p>
<p>We can see that the spread in the fitted model and the residuals is
comparable with the fitted model explaining a bit more of the
variability in the data than adopting the much simpler <em>mean</em>
model in Figure 16.</p>
<div class="section level4">
<h4 id="using-eda_rfs-with-a-regression-model">Using eda_rfs() with a regression model<a class="anchor" aria-label="anchor" href="#using-eda_rfs-with-a-regression-model"></a>
</h4>
<p>You must first create a model using either the built-in
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> function or this package’s <code>eda_lm</code> or
<code>eda_rline</code> functions. For example, to evaluate the effect a
linear model has in estimating the miles per gallon (<code>mpg</code>)
from a vehicle’s horsepower (<code>hp</code>), we first define the
model, then pass that model to the <code>eda_rfs</code> function. Here,
we’ll use the package’s <code>eda_lm</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_lm.html">eda_lm</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">hp</span>, <span class="va">mpg</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-24-1.png" alt="Figure 21. A scatter plot of miles-per-gallon vs horsepower from the built-in mtcars dataset. A linear model is fitted to the data." width="480"><p class="caption">
Figure 21. A scatter plot of miles-per-gallon vs horsepower from the
built-in mtcars dataset. A linear model is fitted to the data.
</p>
</div>
<p>The resulting rfs plot is shown in Figure 22.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_rfs.html">eda_rfs</a></span><span class="op">(</span><span class="va">M1</span>, q <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  The mid 90.0% of residuals covers about 12.79 units.</span></span>
<span><span class="co">#&gt;  The fitted values cover a range of 19.31 units, or about 150.9% of the mid 90.0% of residuals.</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rfs_files/figure-html/unnamed-chunk-25-1.png" alt="Figure 22. A scatter plot of miles-per-gallon vs horsepower from the built-in mtcars dataset. A linear model is fitted to the data." width="480"><p class="caption">
Figure 22. A scatter plot of miles-per-gallon vs horsepower from the
built-in mtcars dataset. A linear model is fitted to the data.
</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h3>
<p>Cleveland, William S. (1993) <em>Visualizing Data</em>. Hobart
Press.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Manuel Gimond.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
