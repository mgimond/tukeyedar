<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Median polish • tukeyedar</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Median polish">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tukeyedar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/polish.html">Median polish</a></li>
    <li><a class="dropdown-item" href="../articles/qq.html">The empirical QQ plot (and derived Tukey mean-difference plot)</a></li>
    <li><a class="dropdown-item" href="../articles/RLine.html">Resistant Line</a></li>
    <li><a class="dropdown-item" href="../articles/symqq.html">The symmetry QQ plot</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mgimond/tukeyedar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Median polish</h1>
                        <h4 data-toc-skip class="author">Manuel
Gimond</h4>
            
            <h4 data-toc-skip class="date">2024-07-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mgimond/tukeyedar/blob/main/vignettes/polish.Rmd" class="external-link"><code>vignettes/polish.Rmd</code></a></small>
      <div class="d-none name"><code>polish.Rmd</code></div>
    </div>

    
    
<style type="text/css">
.caption {
  text-align: center;
  font-weight: 600;
  font-style: italic;
  color: #999999;
}
</style>
<div class="section level2">
<h2 id="the-median-polish-basics">The median polish basics<a class="anchor" aria-label="anchor" href="#the-median-polish-basics"></a>
</h2>
<p>The median polish is an exploratory technique used to extract effects
from a two-way table. As such, a median polish can be thought of as a
robust version of a <a href="https://mgimond.github.io/Stats-in-R/ANOVA.html#two-way-anova" class="external-link">two-way
ANOVA</a>–the goal being to characterize the role each factor has in
contributing towards the expected value. It does so by iteratively
extracting the effects associated with the row and column factors via
medians.</p>
<p>For example, given a two-way table where 1964 through 1966 infant
mortality rates<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;&lt;em&gt;Understanding Robust and Exploratory Data
Analysis&lt;/em&gt;, D.C. Hoaglin, F. Mosteller and J.W. Tukey, 1983.&lt;/p&gt;"><sup>1</sup></a> (reported as count per 1000 live births) is
computed for each combination of geographic region (<code>NE</code>,
<code>NC</code>, <code>S</code>, <code>W</code>) and each level of the
father’s educational attainment (<code>ed8</code>, <code>ed9-11</code>,
<code>ed12</code>, <code>ed13-15</code>, <code>ed16</code>), the median
polish will first extract the overall median value, then it will
<em>smooth</em> out the residual rates by first extracting the median
values along each column (thus contributing to the column factor), then
by <em>smoothing</em> out the remaining residual rates by extracting the
median values along each row (thus contributing to the row factor). The
smoothing operation is iterated until the residuals stabilize. An
example of the workflow is highlighted in the following figure.</p>
<p><img src="polish_files/figure-html/unnamed-chunk-2-1.png" width="1056"></p>
<p>The left-most table is the original data showing death rates. The
second table shows the outcome of the first round of polishing
(including the initial overall median value of 20.2). The third and
forth table show the second and third iterations of the smoothing
operations. Additional iterations are not deemed necessary given that
little more can be extracted from the residuals. For a detailed
step-by-step explanation of the workflow see <a href="https://mgimond.github.io/ES218/two_way.html#median-polish" class="external-link">here</a>.</p>
<p>The resulting model is additive in the form of:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>μ</mi><mo>+</mo><msub><mi>α</mi><mi>i</mi></msub><mo>+</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><msub><mi>ϵ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
y_{ij} = \mu + \alpha_{i} + \beta_{j} +\epsilon_{ij}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">y_{ij}</annotation></semantics></math>
is the <strong>response variable</strong> for row
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and column
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the overall typical value (hereafter referred to as the
<strong>common value</strong>),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\alpha_{i}</annotation></semantics></math>
is the <strong>row effect</strong>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\beta_{j}</annotation></semantics></math>
is the <strong>column effect</strong> and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\epsilon_{ij}</annotation></semantics></math>
is the <strong>residual</strong> or value left over after all effects
are taken into account.</p>
<p>Each factor’s levels are displayed in the top row and left-most
column. In the above example, the region is assigned to the rows and the
father’s educational attainment is assigned to the columns. The father’s
educational attainment can explain about <code>11</code> units of
variability (<code>7.58</code> - <code>(-3.45)</code>) in death rates vs
<code>4</code> units of variability for the region (<code>2.55</code> -
<code>(-1.5)</code>). As such, the father’s educational attainment is a
larger contributor to the expected infant mortality than the regional
effect.</p>
</div>
<div class="section level2">
<h2 id="implementing-the-median-polish">Implementing the median polish<a class="anchor" aria-label="anchor" href="#implementing-the-median-polish"></a>
</h2>
<p>This package’s <code>eda_polish</code> is an augmented version of the
built-in <code>medpolish</code> available via the <code>stats</code>
package. A key difference is that <code>eda_polish</code> takes the
input dataset in long form as opposed to <code>medpolish</code> which
takes the dataset in the form of a matrix. For example, the infant
mortality dataset needs to consist of at least three columns: one for
each variable (the two factors and the expected value).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>grd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ed8"</span>, <span class="st">"ed9-11"</span>, <span class="st">"ed12"</span>, <span class="st">"ed13-15"</span>, <span class="st">"ed16"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">region =</span>  <span class="fu">rep</span>( <span class="fu">c</span>(<span class="st">"NE"</span>, <span class="st">"NC"</span>, <span class="st">"S"</span>, <span class="st">"W"</span>), <span class="at">each =</span> <span class="dv">5</span>),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                  <span class="at">edu =</span> <span class="fu">factor</span>(<span class="fu">rep</span>( grd , <span class="dv">4</span>), <span class="at">levels =</span> grd),</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>                  <span class="at">perc =</span> <span class="fu">c</span>(<span class="fl">25.3</span>, <span class="fl">25.3</span>, <span class="fl">18.2</span>, <span class="fl">18.3</span>, <span class="fl">16.3</span>, <span class="fl">32.1</span>, <span class="dv">29</span>, <span class="fl">18.8</span>,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>                           <span class="fl">24.3</span>, <span class="dv">19</span>, <span class="fl">38.8</span>, <span class="dv">31</span>, <span class="fl">19.3</span>, <span class="fl">15.7</span>, <span class="fl">16.8</span>, <span class="fl">25.4</span>, </span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>                           <span class="fl">21.1</span>, <span class="fl">20.3</span>, <span class="dv">24</span>, <span class="fl">17.5</span>))</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">head</span>(dat)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    region     edu perc</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="dv">1</span>     NE     ed8 <span class="fl">25.3</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="dv">2</span>     NE  ed9<span class="dv">-11</span> <span class="fl">25.3</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="dv">3</span>     NE    ed12 <span class="fl">18.2</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="dv">4</span>     NE ed13<span class="dv">-15</span> <span class="fl">18.3</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="dv">5</span>     NE    ed16 <span class="fl">16.3</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="dv">6</span>     NC     ed8 <span class="fl">32.1</span></span></code></pre></div>
<p>The median polish can then be executed as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mgimond.github.io/tukeyedar/">tukeyedar</a></span><span class="op">)</span></span>
<span><span class="va">M1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">dat</span>, row <span class="op">=</span> <span class="va">region</span>, col <span class="op">=</span> <span class="va">edu</span>, val <span class="op">=</span> <span class="va">perc</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-5-1.png" width="288"></p>
<p>The function will output the table as a plot along with a list of
components that are stored in the <code>M1</code> object. If you want to
suppress the plot, you can set the parameter
<code>plot = FALSE</code>.</p>
<p>The <code>M1</code> object is of class <code>eda_polish</code>. You
can extract the common values, and the row and column effects as
follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>M1<span class="sc">$</span>global</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  [<span class="dv">1</span>] <span class="fl">20.85</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>M1<span class="sc">$</span>row</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    region  effect</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="dv">1</span>     NC  <span class="fl">2.3000</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="dv">2</span>     NE <span class="sc">-</span><span class="fl">1.4625</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="dv">3</span>      S <span class="sc">-</span><span class="fl">0.3500</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="dv">4</span>      W  <span class="fl">0.3500</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>M1<span class="sc">$</span>col</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>        edu   effect</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="dv">1</span>     ed8  <span class="fl">7.43125</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="dv">2</span>  ed9<span class="dv">-11</span>  <span class="fl">5.88125</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="dv">3</span>    ed12 <span class="sc">-</span><span class="fl">1.19375</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="dv">4</span> ed13<span class="dv">-15</span>  <span class="fl">0.03125</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="dv">5</span>    ed16 <span class="sc">-</span><span class="fl">3.70000</span></span></code></pre></div>
<div class="section level3">
<h3 id="ordering-rows-and-columns-by-effect-values">Ordering rows and columns by effect values<a class="anchor" aria-label="anchor" href="#ordering-rows-and-columns-by-effect-values"></a>
</h3>
<p>To order the row and column effects by effect values, set the
<code>sort</code> parameter to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">dat</span>, row <span class="op">=</span> <span class="va">region</span>, col <span class="op">=</span> <span class="va">edu</span>, val <span class="op">=</span> <span class="va">perc</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-10-1.png" width="288"></p>
</div>
<div class="section level3">
<h3 id="applying-a-transformation-to-the-data">Applying a transformation to the data<a class="anchor" aria-label="anchor" href="#applying-a-transformation-to-the-data"></a>
</h3>
<p>You can have the function re-express the values prior to performing
the polish. For example, to log transform the data, pass the value
<code>0</code> to <code>p</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">dat</span>, row <span class="op">=</span> <span class="va">region</span>, col <span class="op">=</span> <span class="va">edu</span>, val <span class="op">=</span> <span class="va">perc</span>, p <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-12-1.png" width="288"></p>
<p>If you are re-expressing the data using a negative power, you have
the choice of adopting a Tukey transformation
(<code>tukey = TRUE</code>) or a Box-Cox transformation
(<code>tukey = FALSE</code>). For example, to apply a power
transformation of -0.1 using a Box-Cox transformation, type:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">dat</span>, row <span class="op">=</span> <span class="va">region</span>, col <span class="op">=</span> <span class="va">edu</span>, val <span class="op">=</span> <span class="va">perc</span>, p <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, tukey <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-14-1.png" width="288"></p>
</div>
<div class="section level3">
<h3 id="defining-the-statistic">Defining the statistic<a class="anchor" aria-label="anchor" href="#defining-the-statistic"></a>
</h3>
<p>By default, the polishing routine adopts the median statistic. You
can adopt any other statistic via the <code>stat</code> parameter. For
example, to apply a <strong>mean polish</strong>, type:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">dat</span>, row <span class="op">=</span> <span class="va">region</span>, col <span class="op">=</span> <span class="va">edu</span>, val <span class="op">=</span> <span class="va">perc</span>, stat <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-16-1.png" width="288"></p>
</div>
</div>
<div class="section level2">
<h2 id="the-eda_polish-plot-method">The <code>eda_polish</code> plot method<a class="anchor" aria-label="anchor" href="#the-eda_polish-plot-method"></a>
</h2>
<p>The list object created by the <code>eda_pol</code> function is of
class <code>eda_polish</code>. As such, there is a plot method created
for that class. The plot method will either output the original polished
table (<code>type = "residuals"</code>), the diagnostic plot
(<code>type = "diagnostic"</code>), or the CV values
(<code>cv</code>).</p>
</div>
<div class="section level2">
<h2 id="plot-the-median-polish-table">Plot the median polish table<a class="anchor" aria-label="anchor" href="#plot-the-median-polish-table"></a>
</h2>
<p>You can generate the plot table from the median polish model as
follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">dat</span>, row <span class="op">=</span> <span class="va">region</span>, col <span class="op">=</span> <span class="va">edu</span>, val <span class="op">=</span> <span class="va">perc</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-18-1.png" width="288"></p>
</div>
<div class="section level2">
<h2 id="adjusting-color-schemes">Adjusting color schemes<a class="anchor" aria-label="anchor" href="#adjusting-color-schemes"></a>
</h2>
<div class="section level3">
<h3 id="excluding-common-effect-from-the-color-palette-range">Excluding common effect from the color palette range<a class="anchor" aria-label="anchor" href="#excluding-common-effect-from-the-color-palette-range"></a>
</h3>
<p>By default, the range of color palettes are defined by the range of
<em>all</em> values in the table–this includes the common effect value.
To prevent the common value from affecting the distribution of color
palettes, set <code>col.com</code> to <code>FALSE</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span>, col.com <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-20-1.png" width="288"></p>
<p>Note how the distribution of colors is maximized to help improve our
view of the effects. This view makes it clear that the father’s
educational attainment has a greater effect than the region.</p>
</div>
<div class="section level3">
<h3 id="excluding-rowcolumn-effects-from-the-color-palette-range">Excluding row/column effects from the color palette range<a class="anchor" aria-label="anchor" href="#excluding-rowcolumn-effects-from-the-color-palette-range"></a>
</h3>
<p>If you want the plot to focus on the residuals by maximizing the
range of colors to fit the range of residual values, set
<code>col.eff = FALSE</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span>, col.eff <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-22-1.png" width="288"></p>
<p>Note that setting <code>col.eff</code> to <code>FALSE</code> does not
prevent the effects cells from being colored. It simply ensures that the
range of colors are maximized to match the full range of residual
values. Any effect value that falls within the residual range will be
assigned a color.</p>
</div>
<div class="section level3">
<h3 id="changing-color-schemes">Changing color schemes<a class="anchor" aria-label="anchor" href="#changing-color-schemes"></a>
</h3>
<p>By default, the color scheme is symmetrical (divergent) and centered
on <code>0</code>. It adopts R’s (version 4.1 and above) built-in
<code>"RdYlBu"</code> color palette. You can assign different built-in
color palettes via the <code>colpal</code> parameter.</p>
<p>You can list available colors in R via the <code><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.pals()</a></code>
function.</p>
<p>If you want to limit the output to divergent color palettes,
type:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">hcl.pals</span>(<span class="at">type =</span> <span class="st">"diverging"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>   [<span class="dv">1</span>] <span class="st">"Blue-Red"</span>      <span class="st">"Blue-Red 2"</span>    <span class="st">"Blue-Red 3"</span>    <span class="st">"Red-Green"</span>    </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>   [<span class="dv">5</span>] <span class="st">"Purple-Green"</span>  <span class="st">"Purple-Brown"</span>  <span class="st">"Green-Brown"</span>   <span class="st">"Blue-Yellow 2"</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>   [<span class="dv">9</span>] <span class="st">"Blue-Yellow 3"</span> <span class="st">"Green-Orange"</span>  <span class="st">"Cyan-Magenta"</span>  <span class="st">"Tropic"</span>       </span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  [<span class="dv">13</span>] <span class="st">"Broc"</span>          <span class="st">"Cork"</span>          <span class="st">"Vik"</span>           <span class="st">"Berlin"</span>       </span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  [<span class="dv">17</span>] <span class="st">"Lisbon"</span>        <span class="st">"Tofino"</span></span></code></pre></div>
<p>For example, we can assign the <code>"Green-Brown"</code> color
palette as follows. (We’ll remove the common effect value from the range
of input values to maximize the displayed set of colors).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span>, colpal <span class="op">=</span> <span class="st">"Green-Brown"</span>, col.com <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-25-1.png" width="288"></p>
<p>The default color scheme is symmetrical and linear, centered on
<code>0</code>. If you want to maximize the use of colors, regardless of
the range of values, you can set <code>col.quant</code> to
<code>TRUE</code> which will adopt a quantile color scheme.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span>, col.quant <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-27-1.png" width="288"></p>
<p>You’ll note that regardless of the asymmetrical distribution of
values about <code>0</code>, each cell is assigned a unique color
swatch.</p>
<p>When adopting a quantile color classification scheme, you might want
to adopt a color palette that generates fewer unique hues and more
variation in lightness values. For example,</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span>, col.quant <span class="op">=</span> <span class="cn">TRUE</span>, colpal <span class="op">=</span> <span class="st">"Green-Orange"</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-29-1.png" width="288"></p>
</div>
</div>
<div class="section level2">
<h2 id="adjusting-text">Adjusting text<a class="anchor" aria-label="anchor" href="#adjusting-text"></a>
</h2>
<p>You can omit all labeled values from the output by setting
<code>res.txt</code> to <code>FALSE</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span>, res.txt <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-31-1.png" width="288"></p>
<p>Likewise you can omit all axes labels by setting
<code>label.txt</code> to <code>FALSE</code>. This may prove useful when
applying a median polish to a large grid file.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span>, res.txt <span class="op">=</span> <span class="cn">FALSE</span>, label.txt <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-33-1.png" width="288"></p>
<p>You can adjust the text size via the <code>res.size</code>,
<code>row.size</code> and <code>col.size</code> parameters for the
numeric values, the row names, and the column names respectively. For
example, to set their sizes to 60% of their default value, type:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span>, row.size <span class="op">=</span> <span class="fl">0.6</span>, col.size <span class="op">=</span> <span class="fl">0.6</span> , res.size <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-34-1.png" width="288"></p>
</div>
<div class="section level2">
<h2 id="exploring-diagnostic-plots">Exploring diagnostic plots<a class="anchor" aria-label="anchor" href="#exploring-diagnostic-plots"></a>
</h2>
<p>The <code>plot</code> method will also generate a plot of the
residuals vs comparison values (CV), herein referred to as the
<strong>diagnostic plot</strong>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M1</span>, type <span class="op">=</span> <span class="st">"diagnostic"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-35-1.png" width="288"></p>
<pre><code>  $slope
      cv 
  1.3688</code></pre>
<p>A bisquare robust line is fitted to the data (light red line) along
with a robust loess fit (dashed blue line). The function will also
output the line’s slope. This slope can be used to help estimate a
transformation of the data, if needed.</p>
<p>To generate your own plot, simply extract the <code>cv</code>
component from the <code>M1</code> list. The <code>cv</code> component
is a dataframe that stores the residuals (first column) and CV values
(fourth column). The first few records of the dataframe are shown
here:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">head</span>(M1<span class="sc">$</span>cv)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>        perc region.eff  edu.eff            cv</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span><span class="fl">3.15625</span>     <span class="fl">2.3000</span> <span class="sc">-</span><span class="fl">1.19375</span> <span class="sc">-</span><span class="fl">0.1316846523</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>  <span class="dv">2</span> <span class="sc">-</span><span class="fl">0.00625</span>    <span class="sc">-</span><span class="fl">0.3500</span> <span class="sc">-</span><span class="fl">1.19375</span>  <span class="fl">0.0200389688</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>  <span class="dv">3</span>  <span class="fl">0.00625</span>    <span class="sc">-</span><span class="fl">1.4625</span> <span class="sc">-</span><span class="fl">1.19375</span>  <span class="fl">0.0837342626</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>  <span class="dv">4</span>  <span class="fl">0.29375</span>     <span class="fl">0.3500</span> <span class="sc">-</span><span class="fl">1.19375</span> <span class="sc">-</span><span class="fl">0.0200389688</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>  <span class="dv">5</span> <span class="sc">-</span><span class="fl">4.83125</span>    <span class="sc">-</span><span class="fl">0.3500</span>  <span class="fl">0.03125</span> <span class="sc">-</span><span class="fl">0.0005245803</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>  <span class="dv">6</span>  <span class="fl">1.11875</span>     <span class="fl">2.3000</span>  <span class="fl">0.03125</span>  <span class="fl">0.0034472422</span></span></code></pre></div>
<p>The diagnostic plot helps identify any interactions between both
effects. If interaction is suspected, then the model is no longer a
simple additive model; The model needs to be augmented with an
interactive component of the form:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>μ</mi><mo>+</mo><msub><mi>α</mi><mi>i</mi></msub><mo>+</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>k</mi><mi>C</mi><mi>V</mi><mo>+</mo><msub><mi>ϵ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
y_{ij} = \mu + \alpha_{i} + \beta_{j} + kCV +\epsilon_{ij}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>V</mi></mrow><annotation encoding="application/x-tex">CV</annotation></semantics></math>
=
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>i</mi></msub><msub><mi>β</mi><mi>j</mi></msub><mi>/</mi><mi>μ</mi></mrow><annotation encoding="application/x-tex">\alpha_{i}\beta_{j}/\mu</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
is a constant that can be estimated from the slope generated in the
diagnostic plot.</p>
<p>A truly additive model is one where the changes in the response
variable from one level to another level remain constant. For example,
given the bottom-left matrix of initial response values, changes in the
response variable from level <code>a</code> to level <code>b</code> are
constant regardless of the row effect. For example, going from
<code>a</code> to <code>b</code> at level <code>z</code> elicits a
change in response of <code>6 - 3 = 3</code>. This is the same observed
change in values from <code>a</code> to <code>b</code> at levels
<code>x</code> and <code>y</code> (<code>4-1</code> and <code>5-2</code>
respectively). At all three row levels, the change in expected values
from <code>a</code> to <code>b</code> is the same–an increase of
<code>3</code> units. Likewise, changes in response values between rows
<code>x</code> and <code>y</code> or <code>y</code> and <code>z</code>
are constant (<code>1</code>) across all levels of the column effect.
The additive effect can be observed in an interaction plot as shown on
the right. The column effect is plotted along the x-axis, the row effect
is mapped to each line segment.</p>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-37-1.png" alt="Original dataset (left). Interaction plot (right)." width="528"><p class="caption">
Original dataset (left). Interaction plot (right).
</p>
</div>
<p><strong>Parallel</strong> lines indicate <strong>no
interaction</strong> between the effects. A median polish generates the
following table and diagnostic plot:</p>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-38-1.png" alt="Median polished data showing no interaction between effects" width="528"><p class="caption">
Median polished data showing no interaction between effects
</p>
</div>
<p>You’ll note the lack of pattern (other than a flat one) in the
accompanying diagnostic plot.</p>
<p>Now, let’s see what happens when an interaction is in fact present in
the two way table.</p>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-39-1.png" alt="Original dataset (left). Interaction plot (right)." width="528"><p class="caption">
Original dataset (left). Interaction plot (right).
</p>
</div>
<p>Note how the lines are no longer parallel to one another in the
interaction plot. Now let’s run the median polish and generate the
diagnostic plot.</p>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-40-1.png" alt="Median polished data showing interaction between effects" width="528"><p class="caption">
Median polished data showing interaction between effects
</p>
</div>
<p>You’ll note the upward trend in residuals with increasing comparison
values. This is usually a good indication of interaction in the effects.
Another telltale sign is the pattern observed in the residuals of the
median polish plot with low residuals and high residuals in opposing
corners of the table.</p>
<p>If an interaction is observed, you should either include the
interaction term in the additive model, or you should seek a
re-expression that might help alleviate any interaction between the
effects.</p>
<p>If you choose to include the interaction term in your model, the
coefficient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
can be extracted from the slope generated in the diagnostic plot.</p>
<p>If you choose to re-express the data in the hopes of removing any
interaction in the data, you can try using a power transformation equal
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>s</mi><mi>l</mi><mi>o</mi><mi>p</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">1 - slope</annotation></semantics></math>
(slope being derived from the diagnostic plot).</p>
<p>The infant mortality dataset used in this exercise does not suggest
interaction between effects in the diagnostic plot. Next, we’ll look at
another dataset that may exhibit interaction between its effects.</p>
<div class="section level3">
<h3 id="another-example-earnings-by-sex-for-2021">Another example: Earnings by sex for 2021<a class="anchor" aria-label="anchor" href="#another-example-earnings-by-sex-for-2021"></a>
</h3>
<p>The dataset consists of earnings by sex and levels of educational
attainment for 2021 (<em>src: US Census Bureau</em>).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NoHS"</span>, <span class="st">"HS"</span>, <span class="st">"HS+2"</span>, <span class="st">"HS+4"</span>, <span class="st">"HS+6"</span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Education <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">edu</span>,<span class="fl">2</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">edu</span><span class="op">)</span>,</span>
<span>                  Sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Female"</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  Earnings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">31722</span>, <span class="fl">40514</span>, <span class="fl">49288</span>, <span class="fl">73128</span>,<span class="fl">98840</span>,<span class="fl">20448</span>,</span>
<span>                                    <span class="fl">26967</span>, <span class="fl">33430</span>, <span class="fl">50554</span>, <span class="fl">67202</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>Education</code> levels are defined as follows:</p>
<ul>
<li>
<code>NoHS</code>: Less than High School Graduate</li>
<li>
<code>HS</code>: High School Graduate (Includes Equivalency)</li>
<li>
<code>AD</code>: Some College or Associate’s Degree</li>
<li>
<code>Grad</code>: Bachelor’s Degree</li>
</ul>
<p>The original table (prior to running the median polish), can be
viewed by setting <code>maxiter</code> to <code>0</code> in the call to
<code>eda_pol</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">df1</span>, row <span class="op">=</span> <span class="va">Education</span>, col <span class="op">=</span> <span class="va">Sex</span>, val <span class="op">=</span> <span class="va">Earnings</span> , maxiter <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-42-1.png" alt="2021 Average earnings for the US." width="268.8"><p class="caption">
2021 Average earnings for the US.
</p>
</div>
<p>Next, we’ll run the median polish.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">df1</span>, row <span class="op">=</span> <span class="va">Education</span>, col <span class="op">=</span> <span class="va">Sex</span>, val <span class="op">=</span> <span class="va">Earnings</span> , plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Next, we plot the final table and the diagnostic plot.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M2</span>, res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M2</span>, <span class="st">"diagnostic"</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-44-1.png" width="528"></p>
<pre><code>  $slope
         cv 
  0.9410244</code></pre>
<p>Here’s what we can glean from the output:</p>
<ul>
<li>Overall, the median earnings is $41,359</li>
<li>Variability in earnings due to different levels in education
attainment covers a range of $56,936 while that for different sexes
covers a range of $15,858.</li>
<li>Some of the residuals are quite large suggesting that there may be
much of the variability in earnings that may not be explained by the row
and column effects. The residuals explain $15,780 of the variability in
the data.</li>
<li>The diagnostic plot suggests a strong interaction between the sex
effect and the education effect. This implies, as an example, that
differences in earnings between sexes <em>depend</em> on the level of
educational attainment.</li>
<li>The slope between residuals and CV values is around 0.94.</li>
</ul>
<p>Given strong evidence of interaction between the effects, we need to
take one of two actions: We can either add the comparison values (CV) to
the row-plus-column model, or we can see if re-expressing the earnings
values eliminates the dependence between effects.</p>
<div class="section level4">
<h4 id="adding-cv-to-the-row-plus-column-model">Adding CV to the row-plus-column model<a class="anchor" aria-label="anchor" href="#adding-cv-to-the-row-plus-column-model"></a>
</h4>
<p>The CV values are computed and stored in the median polish object.
They can be extracted from the model via the <code>M2$cv</code>
component or they can be visualized via the <code>plot</code> function.
The following figure shows both the original residuals table (left) and
the CV table (right).</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M2</span>, res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M2</span>, <span class="st">"cv"</span>, res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-45-1.png" alt="Median polish residuals (left) and CV values (right)." width="528"><p class="caption">
Median polish residuals (left) and CV values (right).
</p>
</div>
<p>If the comparison value is to be added to the model, we will need to
compute a new set of residuals. These residuals can be plotted by
setting <code>add.cv</code> to <code>TRUE</code> and by specifying a
value for <code>k</code>. Using the slope to estimate <code>k</code> we
get:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M2</span>, <span class="st">"cv"</span>, res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M2</span>, <span class="st">"residuals"</span>, add.cv<span class="op">=</span><span class="cn">TRUE</span>, k <span class="op">=</span> <span class="fl">0.94</span>,</span>
<span>     res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-46-1.png" alt="CV values (left) and new set of residuals (right)." width="528"><p class="caption">
CV values (left) and new set of residuals (right).
</p>
</div>
<p>These two tables provide us with all the parameters that are needed
to construct the model. For example, the Female-NoHS earnings value can
be recreated from the above table as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>a</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><msub><mi>s</mi><mrow><mi>F</mi><mi>e</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>e</mi><mo>−</mo><mi>N</mi><mi>o</mi><mi>H</mi><mi>S</mi></mrow></msub><mo>=</mo><mi>μ</mi><mo>+</mo><mi>S</mi><mi>e</mi><msub><mi>x</mi><mrow><mi>F</mi><mi>e</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>+</mo><mi>E</mi><mi>d</mi><mi>u</mi><mi>c</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><msub><mi>n</mi><mrow><mi>N</mi><mi>o</mi><mi>H</mi><mi>S</mi></mrow></msub><mo>+</mo><mi>k</mi><mi>C</mi><msub><mi>V</mi><mrow><mi>F</mi><mi>e</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>e</mi><mo>−</mo><mi>N</mi><mi>o</mi><mi>H</mi><mi>S</mi></mrow></msub><mo>+</mo><msub><mi>ϵ</mi><mrow><mi>F</mi><mi>e</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>e</mi><mo>−</mo><mi>N</mi><mi>o</mi><mi>H</mi><mi>S</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
Earnings_{Female-NoHS} = \mu + Sex_{Female} + Education_{NoHS} + kCV_{Female-NoHS} + \epsilon_{Female-NoHS}
</annotation></semantics></math> Where:</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>V</mi><mrow><mi>F</mi><mi>e</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>e</mi><mo>−</mo><mi>N</mi><mi>o</mi><mi>H</mi><mi>S</mi></mrow></msub><mo>=</mo><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mi>e</mi><msub><mi>x</mi><mrow><mi>F</mi><mi>e</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>E</mi><mi>d</mi><mi>u</mi><mi>c</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><msub><mi>n</mi><mrow><mi>N</mi><mi>o</mi><mi>H</mi><mi>S</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>μ</mi></mfrac></mrow><annotation encoding="application/x-tex">CV_{Female-NoHS} = \frac{(Sex_{Female})(Education_{NoHS})}{\mu}</annotation></semantics></math></li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
is a constant that can be estimated from the diagnostic plot’s slope
(0.94 in this example).</li>
</ul>
<p>This gives us:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>a</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><msub><mi>s</mi><mrow><mi>F</mi><mi>e</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>e</mi><mo>−</mo><mi>N</mi><mi>o</mi><mi>H</mi><mi>S</mi></mrow></msub><mo>=</mo><mn>41359</mn><mo>−</mo><mn>7929</mn><mo>−</mo><mn>15274</mn><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.94</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>2928.2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>460.5</mn></mrow><annotation encoding="application/x-tex">
Earnings_{Female-NoHS} = 41359 -7929 -15274 + (0.94)(2928.2) -460.5
</annotation></semantics></math></p>
</div>
<div class="section level4">
<h4 id="re-expressing-earnings">Re-expressing earnings<a class="anchor" aria-label="anchor" href="#re-expressing-earnings"></a>
</h4>
<p>It’s possible that the earnings as presented to us are in a scale not
best suited for the analysis. Subtracting the slope value (derived from
the diagnostic plot) from the value of 1 offers a suggested
transformation that may provide us with a scale of measure best suited
for the data. We’ll rerun the median polish using a power transformation
of <code>1 - 0.94 = 0.06</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">df1</span>, row <span class="op">=</span> <span class="va">Education</span>, col <span class="op">=</span> <span class="va">Sex</span>, val <span class="op">=</span> <span class="va">Earnings</span> , </span>
<span>              plot <span class="op">=</span> <span class="cn">FALSE</span>, p <span class="op">=</span> <span class="fl">0.06</span><span class="op">)</span></span></code></pre></div>
<p>Next, we plot the final table and the diagnostic plot.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M3</span>, res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M3</span>, <span class="st">"diagnostic"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-48-1.png" alt="Median polish output (left) and CV values (right)." width="528"><p class="caption">
Median polish output (left) and CV values (right).
</p>
</div>
<p>The power of 0.06 may have been a bit too aggressive given that we’ve
gone from a positive relationship between CV and residual to a negative
relationship between the two. Tweaking the power parameter may be
recommended. This can be done via trial and error, or it can be done
using a technique described next.</p>
</div>
<div class="section level4">
<h4 id="fine-tuning-a-re-expression">Fine tuning a re-expression<a class="anchor" aria-label="anchor" href="#fine-tuning-a-re-expression"></a>
</h4>
<p>Klawonn et al.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;&lt;em&gt;Analysis of contingency tables based in generalized
median polish with power transformations and non-additive models&lt;/em&gt;,
F. Klawonn, B. Jayaram, A. Kukita and F. Pessler. Health Information
Science and Systems, 1:11, 2013.&lt;/p&gt;"><sup>2</sup></a> propose a method for honing in on the
optimal power transformation by finding the one that maximizes each
effect’s spreads vis-a-vis the residuals. They do this by computing the
ratio between the interquartile range of the row an column effects to
the 80% quantile of the residual’s absolute values.</p>
<p>The following code chunk computes this ratio for different power
transformations.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">df1</span>, row <span class="op">=</span> <span class="va">Education</span>, col <span class="op">=</span> <span class="va">Sex</span>, val <span class="op">=</span> <span class="va">Earnings</span>,</span>
<span>                 p <span class="op">=</span> <span class="va">x</span>, plot<span class="op">=</span><span class="cn">FALSE</span>, tukey <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>p<span class="op">=</span><span class="va">out</span><span class="op">$</span><span class="va">power</span>, IQrow <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">IQ_row</span>, IQcol <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">IQ_col</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">IQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">25</span><span class="op">/</span><span class="fl">10</span>,  FUN <span class="op">=</span> <span class="va">f1</span> <span class="op">)</span><span class="op">)</span> <span class="co"># Apply transformations at 0.1 intervals</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">IQrow</span> <span class="op">~</span> <span class="va">p</span>, <span class="va">IQ</span>, type<span class="op">=</span><span class="st">"b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">IQcol</span> <span class="op">~</span> <span class="va">p</span>, <span class="va">IQ</span>, type<span class="op">=</span><span class="st">"b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-49-1.png" alt="Row (left) and column (right) effect IQRs to residuals ratio vs power." width="528"><p class="caption">
Row (left) and column (right) effect IQRs to residuals ratio vs power.
</p>
</div>
<p>The plot suggests a power transformation of 0.1. We’ll re-run the
median polish using this power transformation.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">df1</span>, row <span class="op">=</span> <span class="va">Education</span>, col <span class="op">=</span> <span class="va">Sex</span>, val <span class="op">=</span> <span class="va">Earnings</span>, </span>
<span>              plot <span class="op">=</span> <span class="cn">FALSE</span>, p <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M4</span>, res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M4</span>, <span class="st">"diagnostic"</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-50-1.png" width="528"></p>
<p>The slope is much smaller and the loess fit suggests no monotonically
increasing or decreasing relationship between the residuals and the CV
values. Re-expressing the value seems to have done a good job in
stabilizing the residuals across CV values.</p>
<p>We’ll modify the color scheme so as to place emphasis on the effects
as opposed to the overall value.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M4</span>, col.com <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>     res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> </span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-51-1.png" width="268.8"></p>
<p>Here’s what we can glean from the output:</p>
<ul>
<li>The earnings values are best expressed on a power scale of 0.1.</li>
<li>Overall, the median earnings (in re-expressed form) is about
$19.</li>
<li>Variability in earnings due to different levels in education
attainment covers a range of $3 while that for different sexes covers a
range of $1.</li>
<li>The residuals are much smaller relative to the effects when the
earnings are re-expressed. The residuals explain close to $0 of the
variability in the data. Just about all of the variability can be
explained by the effects.</li>
<li>Re-expressing the values eliminates any interaction between the
effects.</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="the-mean-polish">The mean polish<a class="anchor" aria-label="anchor" href="#the-mean-polish"></a>
</h2>
<p>The <code>eda_pol</code> function accepts any statistical summary
function. By default, it uses the median. For example, the <em>mean</em>
polish generated from the earnings dataset looks like this:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">df1</span>, row <span class="op">=</span> <span class="va">Education</span>, col <span class="op">=</span> <span class="va">Sex</span>, val <span class="op">=</span> <span class="va">Earnings</span> , </span>
<span>              stat <span class="op">=</span> <span class="va">mean</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M5</span>, res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-52-1.png" width="268.8"></p>
<p>Polishing the data using the mean requires a single iteration to
reach a stable output. The mean suffers from its sensitivity to
non-symmetrical distributions and outliers. As such, the median polish
is a more robust summary statistic. That said, running the mean polish
has its benefits: It’s a great way to represent the effects generated
from a <strong>two-way analysis of variance</strong> (aka 2-way ANOVA).
This is confirmed by comparing the above row and column effects to a
traditional 2-way ANOVA technique shown here:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">model.tables</span>(<span class="fu">aov</span>(Earnings <span class="sc">~</span> Sex <span class="sc">+</span> Education, df1))</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  Tables of effects</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  </span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>   Sex </span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>  Sex</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>  Female   Male </span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>   <span class="sc">-</span><span class="dv">9489</span>   <span class="dv">9489</span> </span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>  </span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>   Education </span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a>  Education</span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a>    NoHS     HS   HS<span class="sc">+</span><span class="dv">2</span>   HS<span class="sc">+</span><span class="dv">4</span>   HS<span class="sc">+</span><span class="dv">6</span> </span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">23124</span> <span class="sc">-</span><span class="dv">15469</span>  <span class="sc">-</span><span class="dv">7850</span>  <span class="dv">12632</span>  <span class="dv">33812</span></span></code></pre></div>
<p>As with the median polish, we must concern ourselves with
interactions between the effects. If interaction is present, ANOVA
inferential statistics using the F-test can be untrustworthy.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M5</span>, type <span class="op">=</span> <span class="st">"diagnostic"</span>, res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="polish_files/figure-html/unnamed-chunk-54-1.png" width="268.8"></p>
<pre><code>  $slope
         cv 
  0.9223166</code></pre>
<p>There is strong evidence of interaction. The slope of 0.92 can be
used to estimate a power transformation via
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>s</mi><mi>l</mi><mi>o</mi><mi>p</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">1 - slope</annotation></semantics></math>.
This is close to the power transformation of 0.1 we ended up adopting in
the median polish exercise.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M4b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_pol.html">eda_pol</a></span><span class="op">(</span><span class="va">df1</span>, row <span class="op">=</span> <span class="va">Education</span>, col <span class="op">=</span> <span class="va">Sex</span>, val <span class="op">=</span> <span class="va">Earnings</span> , stat <span class="op">=</span> <span class="va">mean</span>,</span>
<span>               plot <span class="op">=</span> <span class="cn">FALSE</span>, p <span class="op">=</span> <span class="fl">0.1</span>, maxiter <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M4b</span>, res.size <span class="op">=</span> <span class="fl">0.8</span>, row.size <span class="op">=</span> <span class="fl">0.8</span>, col.size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M4b</span>, <span class="st">"diagnostic"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="polish_files/figure-html/unnamed-chunk-55-1.png" alt="Results of a mean polish (left) and its diagnositc plot (right)." width="528"><p class="caption">
Results of a mean polish (left) and its diagnositc plot (right).
</p>
</div>
<p>Re-expressing the data does a nice job in removing the interaction
between effects much like it did when we performed the median polish.
This suggests that if one were to run a two-way ANOVA, a re-expression
would be strongly suggested.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Manuel Gimond.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
