---
title: "The residual-fit spread plot"
author: "Manuel Gimond"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: TRUE
    css: style.css
vignette: >
  %\VignetteIndexEntry{The residual-fit spread plot}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#> ",
  message = FALSE,
  tidy = FALSE,
  cache = FALSE,
  warning = FALSE,
  encoding = "UTF-8"
)
```

```{r include=FALSE}
knitr::opts_chunk$set(echo = TRUE, dev.args=list(pointsize=10))
```

```{css}
.caption {
    text-align: center !important;
    color: darkgrey;
    font-style: italic;
}
```


# Introduction

The *residual-fit spread plot* (rfs plot) is a plot first introduced by William Cleveland designed to compare the variability explained by a fitted model (such as group means for a univariate analysis or a linear model for a bivariate analysis) and the variability in the residuals. It's constructed as follows:

-  A model is fitted to the data.
-  The residuals are computed by subtracting the fitted values from the original values.
-  The estimated values from the model are centered on zero by subtracting, for example, the mean from the values.
-  The centered fitted values and residuals are each sorted from smallest to largest values.
-  Side-by-side plots are created by plotting the sorted fitted values and residuals to their respective f-values (i.e. their fractional contribution) 

Let's start with a simple dataset where a batch of sixty observations. 

```{r fig.height=2.8, fig.width=2.4, echo = FALSE, fig.cap="Figure 1. A batch of 60 values with the mean value represented as a red point.", fig.align="center"}
library(tukeyedar)
set.seed(9591)
df <- data.frame(y = rnorm(60, mean = c(10,11, 12), sd = 0.5), 
                 group = rep(c("a","b","c"), times = 20))

df.all <- df; df.all$group = " "
eda_boxls(df.all, y, group, fill = "white", outcol = "white", xlab = "All values",
          whiskcol = "white" , show.par = FALSE, medcol = "white", outlier = FALSE)
OP <- par(mar = c(0, 0, 0, 0))
points(x= jitter(rep(1,60), amount = 0.04), 
       y = df.all$y, pch = 21, col = "grey50", bg = "grey80")
points(x=1, tapply(df.all$y,df.all$group, FUN = mean), cex=2, col = "red3", pch=16)
par(OP)
```

At best, we can estimate the expected value using some summary statistic such as the mean (red point in figure 1)--`r round(mean(df$y),2)` in this working example. This gives us quite a bit of variability in predicting `y` given that the noise in the data covers a range of `r round(range(df$y),2)` or around `r round(diff(range(df$y)))` units.

If we want to improve our estimation of the value in `y`, we may want to add a grouping variable to the mix. In Figure 2, we see that the samme set of values are now split across groups `a`, `b` and `c`. Doing so, in this example, seems to reduce the variability, or the "randomness" in our estimation of `y`, given that by knowing which group `y` falls into, we can come up with a more precise estimate of the value while reducing the undertainty associated with that estimate.

```{r fig.height=2.8, fig.width=2.8, echo = FALSE, fig.cap="Figure 2. Same batch of values split across three groups with each group's mean displayed as a red point values with the mean value represented as a red point.", fig.align="center"}
eda_boxls(df, y, group, fill = "white", outcol = "white", xlab = "All values",
          whiskcol = "white" , show.par = FALSE, medcol = "white", outlier = FALSE)
OP <- par(mar = c(0, 0, 0, 0))
points(x= jitter(rep(1:3,20), amount = 0.07), 
       y = df$y, pch = 21, col = "grey50", bg = "grey80")
points(x=1:3, tapply(df$y,df$group, FUN = mean), cex=2, col = "red3", pch=16)
par(OP)
```

Eyeballing the three batches, it seems that the uncertainty or noise in the data is reduced down to around two units--an improvement in our estimation. 
An rfs plot helps us assess how will the grouping variable helps improve on our estimation in `y` vis-a-vis the variability in the data.

```{r fig.height=3.2, fig.width=5, echo = FALSE, fig.cap="Figure 3. A residual-fit spread plot. Each observation is split between its mean value (left plot) and its residual (right plot). TO facilitate comparison between both plots, the mean value is centered on zero. Its residual counterpart is already centered on 0 given that it's the error about the group's mean value.", fig.align="center", results='hide'}
eda_rfs(df, y, group)
```



