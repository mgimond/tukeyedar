<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Resistant Line • tukeyedar</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Resistant Line">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tukeyedar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/polish.html">Median polish</a></li>
    <li><a class="dropdown-item" href="../articles/qq.html">The empirical QQ plot (and derived Tukey mean-difference plot)</a></li>
    <li><a class="dropdown-item" href="../articles/rfs.html">The residual-fit spread plot</a></li>
    <li><a class="dropdown-item" href="../articles/RLine.html">Resistant Line</a></li>
    <li><a class="dropdown-item" href="../articles/symqq.html">The symmetry QQ plot</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mgimond/tukeyedar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Resistant Line</h1>
                        <h4 data-toc-skip class="author">Manuel
Gimond</h4>
            
            <h4 data-toc-skip class="date">2025-01-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mgimond/tukeyedar/blob/HEAD/vignettes/RLine.Rmd" class="external-link"><code>vignettes/RLine.Rmd</code></a></small>
      <div class="d-none name"><code>RLine.Rmd</code></div>
    </div>

    
    
<p><link href="http://fonts.googleapis.com/css?family=Open+Sans%7CSource+Code+Pro" rel="stylesheet"></p>
<div class="section level3">
<h3 id="the-resistant-line-basics">The resistant line basics<a class="anchor" aria-label="anchor" href="#the-resistant-line-basics"></a>
</h3>
<p>The <code>eda_rline</code> function fits a robust line through a
bivariate dataset. It does so by first breaking the data into three
roughly equal sized batches following the x-axis variable. It then uses
the batches’ median values to compute the slope and intercept.</p>
<p>However, the function doesn’t stop there. After fitting the inital
line, the function fits another line (following the aforementioned
methodology) to the model’s residuals. If the slope is not close to
zero, the residual slope is added to the original fitted model creating
an <em>updated</em> model. This iteration is repeated until the residual
slope is close to zero or until the residual slope changes in sign (at
which point the average of the last two iterated slopes is used in the
final fit).</p>
<p>An example of the iteration follows using data from Velleman et. al’s
book. The dataset, <code>neoplasms</code>, consists of breast cancer
mortality rates for regions with varying mean annual temperatures.</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-2-1.png" width="307.2"></p>
<pre><code><span><span class="co">#&gt;  NULL</span></span></code></pre>
<p>The three batches are divided as follows:</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-3-1.png" width="307.2"></p>
<p>Note that the 16 record dataset is not divisible by three thus
forcing an extra point in the middle batch (had the remainder of the
division by three been two, then each extra point would have been added
to the tail-end batches).</p>
<p>Next, we compute the medians for each batch (highlighted as red
points in the following figure).</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-4-1.png" width="307.2"></p>
<p>The two end medians are used to compute the slope as:</p>
<p><span class="math display">\[
b = \frac{y_r - y_l}{x_r-x_l}
\]</span></p>
<p>where the subscripts <span class="math inline">\(r\)</span> and <span class="math inline">\(l\)</span> reference the median values for the
right-most and left-most batches.</p>
<p>Once the slope is computed, the intercept can be computed as
follows:</p>
<p><span class="math display">\[
median(y_{l,m,r} - b * x_{l,m,r})
\]</span></p>
<p>where <span class="math inline">\((x,y)_{l,m,r}\)</span> are the
median x and y values for each batch. This line is then used to compute
the first set of residuals. A line is then fitted to the residuals
following the same procedure outlined above.</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-5-1.png" width="528"></p>
<p>The initial model slope and intercept are 3.412 and -69.877
respectively and the residual’s slope and intercept are -0.873 and
41.451 respectively. The residual slope is then added to the first
computed slope and the process is again repeated thus generating the
following tweaked slope and updated residuals:</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-6-1.png" width="528"></p>
<p>The updated slope is now 3.412 + (-0.873) = 2.539. The iteration
continues until the slope residuals stabilize. The final line for this
working example is,</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-7-1.png" width="307.2"></p>
<p>where the final slope and intercept are 2.89 and -46.2,
respectively.</p>
</div>
<div class="section level3">
<h3 id="implementing-the-resistant-line">Implementing the resistant line<a class="anchor" aria-label="anchor" href="#implementing-the-resistant-line"></a>
</h3>
<p>The <code>eda_rline</code> takes just three arguments: data frame, x
variable and y variable. The function output is a list.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mgimond.github.io/tukeyedar/">tukeyedar</a></span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">neoplasms</span>, <span class="va">Temp</span>, <span class="va">Mortality</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span></span>
<span><span class="co">#&gt;  $b</span></span>
<span><span class="co">#&gt;  [1] 2.890173</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $a</span></span>
<span><span class="co">#&gt;  [1] -46.20241</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $residuals</span></span>
<span><span class="co">#&gt;   [1]  21.59489403   0.43651252  -1.88256262   9.12610790 -10.95192678</span></span>
<span><span class="co">#&gt;   [6]  -7.32013487   0.15674374   5.05558767  -8.71262042  -1.90279383</span></span>
<span><span class="co">#&gt;  [11]   3.05211946  -6.97100193  -0.09412331   6.48275530   2.09373796</span></span>
<span><span class="co">#&gt;  [16]   0.43651252</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $x</span></span>
<span><span class="co">#&gt;   [1] 31.8 34.0 40.2 42.1 42.3 43.5 44.2 45.1 46.3 47.3 47.8 48.5 49.2 49.9 50.0</span></span>
<span><span class="co">#&gt;  [16] 51.3</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $y</span></span>
<span><span class="co">#&gt;   [1]  67.3  52.5  68.1  84.6  65.1  72.2  81.7  89.2  78.9  88.6  95.0  87.0</span></span>
<span><span class="co">#&gt;  [13]  95.9 104.5 100.4 102.5</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $xmed</span></span>
<span><span class="co">#&gt;  [1] 40.2 45.7 49.9</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $ymed</span></span>
<span><span class="co">#&gt;  [1]  67.30  85.15 100.40</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $index</span></span>
<span><span class="co">#&gt;  [1]  5 11 16</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $xlab</span></span>
<span><span class="co">#&gt;  [1] "Temp"</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $ylab</span></span>
<span><span class="co">#&gt;  [1] "Mortality"</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $px</span></span>
<span><span class="co">#&gt;  [1] 1</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $py</span></span>
<span><span class="co">#&gt;  [1] 1</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $iter</span></span>
<span><span class="co">#&gt;  [1] 4</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  $fitted.values</span></span>
<span><span class="co">#&gt;   [1]  45.70511  52.06349  69.98256  75.47389  76.05193  79.52013  81.54326</span></span>
<span><span class="co">#&gt;   [8]  84.14441  87.61262  90.50279  91.94788  93.97100  95.99412  98.01724</span></span>
<span><span class="co">#&gt;  [15]  98.30626 102.06349</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  attr(,"class")</span></span>
<span><span class="co">#&gt;  [1] "eda_rline"</span></span></code></pre></div>
<p>The elements <code>a</code> and <code>b</code> are the model’s
intercept and slope. The vectors <code>x</code> and <code>y</code> are
the input values sorted on <code>x</code>. <code>res</code> is a vector
of the final residuals sorted on <code>x</code>. <code>xmed</code> and
<code>ymed</code> are vectors of the medians for each of the three
batches. <code>px</code> and <code>py</code> are power transformations
applied to the variables.</p>
<p>The output is a list of class <code>eda_rline</code>. A
<code>plot</code> method is available for this class.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-10-1.png" width="307.2"></p>
<p>To see how this resistant line compares to an ordinary least-squares
(OLS) regression slope, add the output of the <code>lm</code> model to
the plot via <code><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Mortality</span> <span class="op">~</span> <span class="va">Temp</span>, <span class="va">neoplasms</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-11-1.png" width="307.2"></p>
<p>The regression model computes a slope of <code>2.36</code> whereas
the resistant line function generates a slope of <code>2.89</code>. From
the scatter plot, we can spot a point that may have undo influence on
the regression line (this point is highlighted in green in the following
plot).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">neoplasms</span><span class="op">[</span><span class="fl">15</span>,<span class="op">]</span>, col<span class="op">=</span><span class="st">"#43CD80"</span>,cex<span class="op">=</span><span class="fl">1.5</span> ,pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-12-1.png" width="307.2"></p>
<p>Removing that point from the data generates an OLS regression line
more inline with our resistant model. The point of interest is the
15<sup>th</sup> record in the <code>neoplasms</code> data frame.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neoplasms.sub</span> <span class="op">&lt;-</span> <span class="va">neoplasms</span><span class="op">[</span><span class="op">-</span><span class="fl">15</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">neoplasms.sub</span>, <span class="va">Temp</span>, <span class="va">Mortality</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M.sub</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Mortality</span> <span class="op">~</span> <span class="va">Temp</span>, <span class="va">neoplasms.sub</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Regression model with data subset</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-14-1.png" width="307.2"></p>
<p>Note how the OLS slope is inline with that generated from the
resistant line. You’ll also note that the resistant line slope has also
changed. Despite the resistant nature of the line, the removal of this
point changed the makeup of the first tier of values (note the leftward
shift in the vertical dashed line). This changed the makeup of this
batch thus changing the median values for the first and second tier
batches.</p>
</div>
<div class="section level3">
<h3 id="other-examples">Other examples<a class="anchor" aria-label="anchor" href="#other-examples"></a>
</h3>
<div class="section level4">
<h4 id="nine-point-data">Nine point data<a class="anchor" aria-label="anchor" href="#nine-point-data"></a>
</h4>
<p>The <code>nine_point</code> dataset is used by Hoaglin et. al
(p. 139) to test the resistant line function’s ability to stabilize wild
oscillations in the computed slopes across iterations.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">nine_point</span>, <span class="va">X</span>,<span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-15-1.png" width="307.2"></p>
<p>Here, slope and intercept are 0.067 and 0.133 respectively matching
the 1/15 and 2/15 values computed by Hoaglin et. al.</p>
</div>
<div class="section level4">
<h4 id="age-vs--height-data">Age vs. height data<a class="anchor" aria-label="anchor" href="#age-vs--height-data"></a>
</h4>
<p><code>age_height</code> is another dataset found in Hoaglin et. al
(p. 135). It gives the ages and heights of children from a private urban
school.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">age_height</span>, <span class="va">Months</span>,<span class="va">Height</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-16-1.png" width="307.2"></p>
<p>Here, slope and intercept are 0.429 and 91.221 respectively matching
the 0.426 slope and closely matching the 90.366 intercept values
computed by Hoaglin et. al on page 137.</p>
</div>
</div>
<div class="section level3">
<h3 id="not-all-relationships-are-linear">Not all relationships are linear!<a class="anchor" aria-label="anchor" href="#not-all-relationships-are-linear"></a>
</h3>
<p>It’s important to remember that the resistant line technique is only
valid if the bivariate relationship is linear. Here, we’ll step through
the example highlighted by Velleman et. al (p. 138) using the R built-in
<code>mtcars</code> dataset.</p>
<p>First, we’ll fit the resistant line to the data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span>, <span class="va">mpg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-17-1.png" width="307.2"></p>
<p>It’s important to note that just because a resistant line can be fit
does not necessarily imply that the relationship is linear. To assess
linearity of the <code>mtcars</code> dataset, we’ll make use of the
<code>eda_3pt</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_3pt.html">eda_3pt</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span>, <span class="va">mpg</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-18-1.png" width="307.2"></p>
<p>It’s clear from the two half slopes that the relationship is not
linear. Velleman et. al first suggest re-expressing <code>mpg</code> to
<code>1/mpg</code> (i.e. applying a power transformation of
<code>-1</code>) giving us number of gallons consumed per mile
driven.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_3pt.html">eda_3pt</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span>, <span class="va">mpg</span>, py <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, ylab <span class="op">=</span> <span class="st">"gal/mi"</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-19-1.png" width="307.2"></p>
<p>The two half slopes still differ. We will therefore opt to re-express
the <code>disp</code> variable. One possibility is to take the inverse
of 1/3 since displacement is a measure of volume
(e.g. length<sup>3</sup>) which gives us:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eda_3pt.html">eda_3pt</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span>, <span class="va">mpg</span>,  px <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, py <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"gal/mi"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Displacement"</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-20-1.png" width="307.2"></p>
<p>Now that we have identified re-expressions that linearises the
relationship, we can fit the resistant line. (Note that the grey line
generated by the <code>eda_3pt</code> function is not the same as the
resistant line generated with <code>eda_rline</code>.)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span>, <span class="va">mpg</span>,  px <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, py <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M</span>, ylab <span class="op">=</span> <span class="st">"gal/mi"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Displacement"</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/r-1.png" width="307.2"></p>
</div>
<div class="section level3">
<h3 id="computing-a-confidence-interval">Computing a confidence interval<a class="anchor" aria-label="anchor" href="#computing-a-confidence-interval"></a>
</h3>
<p>Confidence intervals for the coefficients can be estimated using
bootstrapping techniques. There are two approaches: resampling residuals
and resampling x-y cases.</p>
<div class="section level4">
<h4 id="resampling-the-model-residuals">Resampling the model residuals<a class="anchor" aria-label="anchor" href="#resampling-the-model-residuals"></a>
</h4>
<p>Here, we fit the resistant line then extract its residuals. We then
re-run the model many times by replacing the original y values with the
<strong>modeled</strong> y values <strong>plus</strong> the resampled
residuals to generate the confidence intervals.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span>  <span class="op">&lt;-</span> <span class="fl">999</span> <span class="co"># Set number of iterations</span></span>
<span><span class="va">M</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">neoplasms</span>, <span class="va">Temp</span>, <span class="va">Mortality</span><span class="op">)</span> <span class="co"># Fit the resistant line</span></span>
<span><span class="va">bt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Create empty bootstrap array</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span> <span class="co">#bootstrap loop</span></span>
<span>  <span class="va">df.bt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">M</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">M</span><span class="op">$</span><span class="va">res</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">bt</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">df.bt</span>,<span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">$</span><span class="va">a</span></span>
<span>  <span class="va">bt</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">df.bt</span>,<span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">$</span><span class="va">b</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now plot the distributions,</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"Intercept distribution"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"Slope distribution"</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-22-1.png" width="576"></p>
<p>and tabulate the 95% confidence interval.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                     Slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conf</span></span>
<span><span class="co">#&gt;                    5%       95%</span></span>
<span><span class="co">#&gt;  Intercept -75.916394 13.180681</span></span>
<span><span class="co">#&gt;  Slope       1.643678  3.553286</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="resampling-the-x-y-paired-values">Resampling the x-y paired values<a class="anchor" aria-label="anchor" href="#resampling-the-x-y-paired-values"></a>
</h4>
<p>Here, we resample the x-y paired values (with replacement) then
compute the resistant line each time.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span>  <span class="op">&lt;-</span> <span class="fl">1999</span> <span class="co"># Set number of iterations</span></span>
<span><span class="va">bt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Create empty bootstrap array</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span> <span class="co">#bootstrap loop</span></span>
<span>  <span class="va">recs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">neoplasms</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">df.bt</span> <span class="op">&lt;-</span> <span class="va">neoplasms</span><span class="op">[</span><span class="va">recs</span>,<span class="op">]</span></span>
<span>  <span class="va">bt</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">df.bt</span>,<span class="va">Temp</span>,<span class="va">Mortality</span><span class="op">)</span><span class="op">$</span><span class="va">a</span></span>
<span>  <span class="va">bt</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">df.bt</span>,<span class="va">Temp</span>,<span class="va">Mortality</span><span class="op">)</span><span class="op">$</span><span class="va">b</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now plot the distributions,</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"Intercept distribution"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"Slope distribution"</span><span class="op">)</span></span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-25-1.png" width="576"></p>
<p>and tabulate the 95% confidence interval.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>                     Slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conf</span></span>
<span><span class="co">#&gt;                    5%       95%</span></span>
<span><span class="co">#&gt;  Intercept -110.38963 13.187096</span></span>
<span><span class="co">#&gt;  Slope        1.64348  4.183534</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>
<em>Applications, Basics and Computing of Exploratory Data
Analysis</em>, P.F. Velleman and D.C. Hoaglin, 1981.<br>
</li>
<li>
<em>Understanding robust and exploratory data analysis</em>, D.C.
Hoaglin, F. Mosteller and J.W. Tukey, 1983.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Manuel Gimond.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
