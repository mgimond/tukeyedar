<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resistant Line • tukeyedar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Resistant Line">
<meta property="og:description" content="tukeyedar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tukeyedar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction to EDA functions</a>
    </li>
    <li>
      <a href="../articles/RLine.html">Resistant Line</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mgimond/tukeyedar/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="RLine_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Resistant Line</h1>
                        <h4 class="author">Manuel Gimond</h4>
            
            <h4 class="date">2021-10-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mgimond/tukeyedar/blob/master/vignettes/RLine.Rmd"><code>vignettes/RLine.Rmd</code></a></small>
      <div class="hidden name"><code>RLine.Rmd</code></div>

    </div>

    
    
<p><link href="http://fonts.googleapis.com/css?family=Open+Sans%7CSource+Code+Pro" rel="stylesheet"></p>
<div id="the-resistant-line-basics" class="section level2">
<h2 class="hasAnchor">
<a href="#the-resistant-line-basics" class="anchor"></a>The resistant line basics</h2>
<p>The <code>eda_rline</code> function fits a robust line through a bivariate dataset. It does so by first breaking the data into three roughly equal sized batches following the x-axis variable. It then uses the batches’ median values to compute the slope and intercept.</p>
<p>However, the function doesn’t stop there. After fitting the inital line, the function fits another line (following the aforementioned methodology) to the model’s residuals. If the slope is not close to zero, the residual slope is added to the original fitted model creating an <em>updated</em> model. This iteration is repeated until the residual slope is close to zero or until the residual slope changes in sign (at which point the average of the last two iterated slopes is used in the final fit).</p>
<p>An example of the iteration follows using data from Velleman et. al’s book. The dataset, <code>neoplasms</code>, consists of breast cancer mortality rates for regions with varying mean annual temperatures.</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-2-1.png" width="307.2"></p>
<p>The three batches are divided as follows:</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-3-1.png" width="307.2"></p>
<p>Note that the 16 record dataset is not divisible by three thus forcing an extra point in the middle batch (had the remainder of the division by three been two, then each extra point would have been added to the tail-end batches).</p>
<p>Next, we compute the medians for each batch (highlighted as red points in the following figure).</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-4-1.png" width="307.2"></p>
<p>The two end medians are used to compute the slope as:</p>
<p><span class="math display">\[
b = \frac{y_r - y_l}{x_r-x_l}
\]</span></p>
<p>where the subscripts <span class="math inline">\(r\)</span> and <span class="math inline">\(l\)</span> reference the median values for the right-most and left-most batches.</p>
<p>Once the slope is computed, the intercept can be computed as follows:</p>
<p><span class="math display">\[
median(y_{l,m,r} - b * x_{l,m,r})
\]</span></p>
<p>where <span class="math inline">\((x,y)_{l,m,r}\)</span> are the median x and y values for each batch. This line is then used to compute the first set of residuals. A line is then fitted to the residuals following the same procedure outlined above.</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-5-1.png" width="528"></p>
<p>The initial model slope and intercept are 3.412 and -69.877 respectively and the residual’s slope and intercept are -0.873 and 41.451 respectively. The residual slope is then added to the first computed slope and the process is again repeated thus generating the following tweaked slope and updated residuals:</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-6-1.png" width="528"></p>
<p>The updated slope is now 3.412 + (-0.873) = 2.539. The iteration continues until the slope residuals stabilize. The final line for this working example is,</p>
<p><img src="RLine_files/figure-html/unnamed-chunk-7-1.png" width="307.2"></p>
<p>where the final slope and intercept are 2.89 and -45.91, respectively.</p>
</div>
<div id="implementing-the-resistant-line" class="section level2">
<h2 class="hasAnchor">
<a href="#implementing-the-resistant-line" class="anchor"></a>Implementing the resistant line</h2>
<p>The <code>eda_rline</code> takes just three arguments: data frame, x variable and y variable. The function output is a list.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">neoplasms</span>, <span class="va">Temp</span>, <span class="va">Mortality</span><span class="op">)</span>
<span class="va">M</span>
<span class="co">#&gt;  $b</span>
<span class="co">#&gt;  [1] 2.890173</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  $a</span>
<span class="co">#&gt;  [1] -45.90578</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  $res</span>
<span class="co">#&gt;   [1]  21.2982659   0.1398844  -2.1791908   8.8294798 -11.2485549  -7.6167630</span>
<span class="co">#&gt;   [7]  -0.1398844   4.7589595  -9.0092486  -2.1994220   2.7554913  -7.2676301</span>
<span class="co">#&gt;  [13]  -0.3907514   6.1861272   1.7971098   0.1398844</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  $x</span>
<span class="co">#&gt;   [1] 31.8 34.0 40.2 42.1 42.3 43.5 44.2 45.1 46.3 47.3 47.8 48.5 49.2 49.9 50.0</span>
<span class="co">#&gt;  [16] 51.3</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  $y</span>
<span class="co">#&gt;   [1]  67.3  52.5  68.1  84.6  65.1  72.2  81.7  89.2  78.9  88.6  95.0  87.0</span>
<span class="co">#&gt;  [13]  95.9 104.5 100.4 102.5</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  $xmed</span>
<span class="co">#&gt;  [1] 40.2 45.7 49.9</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  $ymed</span>
<span class="co">#&gt;  [1]  67.30  85.15 100.40</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  $index</span>
<span class="co">#&gt;  [1]  5 11 16</span></code></pre></div>
<p>The elements <code>a</code> and <code>b</code> are the model’s intercept and slope. The vectors <code>x</code> and <code>y</code> are the input values sorted on <code>x</code>. <code>res</code> is a vector of the final residuals sorted on <code>x</code>. <code>xmed</code> and <code>ymed</code> are vectors of the medians for each of the three batches.</p>
<p>You can use the output values to generate the following plot.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Mortality</span><span class="op">~</span><span class="va">Temp</span>, <span class="va">neoplasms</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">a</span>, b<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">b</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-9-1.png" width="307.2"></p>
<p>If you wish to add the median values to all three batches for reference, modify the code as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Mortality</span><span class="op">~</span><span class="va">Temp</span>, <span class="va">neoplasms</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">a</span>, b<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">b</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">xmed</span>, y<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">ymed</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">20</span>,cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-10-1.png" width="307.2"></p>
<p>To see how this resistant line compares to an ordinary least-squares (OLS) regression slope, type:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Mortality</span><span class="op">~</span><span class="va">Temp</span>, <span class="va">neoplasms</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">a</span>, b<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">b</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Mortality</span><span class="op">~</span><span class="va">Temp</span>, <span class="va">neoplasms</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Regression model</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-11-1.png" width="307.2"></p>
<p>The regression model computes a slope of <code>2.36</code> whereas the resistant line function generates a slope of <code>2.89</code>. From the scatter plot, we can spot a point that may have undo influence on the regression line (this point is highlighted in green in the following plot).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Mortality</span><span class="op">~</span><span class="va">Temp</span>, <span class="va">neoplasms</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">a</span>, b<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">b</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Mortality</span><span class="op">~</span><span class="va">Temp</span>, <span class="va">neoplasms</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Regression model</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">neoplasms</span><span class="op">[</span><span class="fl">15</span>,<span class="op">]</span>, col<span class="op">=</span><span class="st">"#43CD80"</span>,cex<span class="op">=</span><span class="fl">2</span> ,pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-12-1.png" width="307.2"></p>
<p>Removing that point from the data generates an OLS regression line more inline with our resistant model. The point of interest is the 15<sup>th</sup> record in the <code>neoplasms</code> data frame.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">neoplasms.sub</span> <span class="op">&lt;-</span> <span class="va">neoplasms</span><span class="op">[</span><span class="op">-</span><span class="fl">15</span>,<span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Mortality</span><span class="op">~</span><span class="va">Temp</span>, <span class="va">neoplasms</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">a</span>, b<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">b</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Mortality</span><span class="op">~</span><span class="va">Temp</span>, <span class="va">neoplasms.sub</span><span class="op">)</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Regression model with data subset</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">neoplasms</span><span class="op">[</span><span class="fl">15</span>,<span class="op">]</span>, col<span class="op">=</span><span class="st">"#43CD80"</span>,cex<span class="op">=</span><span class="fl">2</span> ,pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-14-1.png" width="307.2"></p>
</div>
<div id="other-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#other-examples" class="anchor"></a>Other examples</h2>
<div id="nine-point-data" class="section level3">
<h3 class="hasAnchor">
<a href="#nine-point-data" class="anchor"></a>Nine point data</h3>
<p>The <code>nine_point</code> dataset is used by Hoaglin et. al (p. 139) to test the resistant line function’s ability to stabilize wild oscillations in the computed slopes across iterations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">nine_point</span>, <span class="va">X</span>,<span class="va">Y</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, <span class="va">nine_point</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">a</span>, b<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">b</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-16-1.png" width="307.2"></p>
<p>Here, slope and intercept are 0.067 and 0.133 respectively matching the 1/15 and 2/15 values computed by Hoaglin et. al.</p>
</div>
<div id="age-vs--height-data" class="section level3">
<h3 class="hasAnchor">
<a href="#age-vs--height-data" class="anchor"></a>Age vs. height data</h3>
<p><code>age_height</code> is another dataset pulled from Hoaglin et. al (p. 135). It gives the ages and heights of children from a private urban school.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">age_height</span>, <span class="va">Months</span>,<span class="va">Height</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Height</span> <span class="op">~</span> <span class="va">Months</span>, <span class="va">age_height</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">a</span>, b<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">b</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-18-1.png" width="307.2"></p>
<p>Here, slope and intercept are 0.429 and 91.007 respectively matching the 0.426 slope and closely matching the 90.366 intercept values computed by Hoaglin et. al on page 137.</p>
</div>
</div>
<div id="not-all-relationships-are-linear" class="section level2">
<h2 class="hasAnchor">
<a href="#not-all-relationships-are-linear" class="anchor"></a>Not all relationships are linear!</h2>
<p>It’s important to remember that the resistant line technique is only valid if the bivariate relationship is linear. Here, we’ll step through the example highlighted by Velleman et. al (p. 138) using the R built-in <code>mtcars</code> dataset.</p>
<p>First, we’ll fit the resistant line to the data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span>, <span class="va">mpg</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">disp</span>, <span class="va">mtcars</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">a</span>, b<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">b</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-20-1.png" width="307.2"></p>
<p>It’s important to note that just because a resistant line can be fit does not necessarily imply that the relationship is linear. To assess linearity of the <code>mtcars</code> dataset, we’ll make use of the <code>eda_3pt</code> function (see the <a href="Introduction.html#eda_3pt">accompanying vignette</a> for details on interpreting the 3-point summary function).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/eda_3pt.html">eda_3pt</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span>, <span class="va">mpg</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-21-1.png" width="307.2"></p>
<p>It’s clear from the two half slopes that the relationship is not linear. Velleman et. al first suggest re-expressing <code>mpg</code> to <code>1/mpg</code> giving us number of gallons consumed per mile driven.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/eda_3pt.html">eda_3pt</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span>, <span class="fl">1</span><span class="op">/</span><span class="va">mpg</span>, y.lab <span class="op">=</span> <span class="st">"gal/mi"</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-22-1.png" width="307.2"></p>
<p>This is an improvement, however the two half slopes still differ significantly. We will therefore opt to re-express the <code>disp</code> variable. One possibility is to take the inverse of 1/3 since displacement is a measure of volume (e.g. length<sup>3</sup>) which gives us:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/eda_3pt.html">eda_3pt</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">1</span><span class="op">/</span><span class="va">mpg</span>, 
        y.lab <span class="op">=</span> <span class="st">"gal/mi"</span>,
        x.lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Displacement"</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-23-1.png" width="307.2"></p>
<p>Now that we have identified re-expressions that linearise the relationship, we can fit the resistant line. (Note that the grey line generated by the <code>eda_3pt</code> function is not the same as the resistant line generated with <code>eda_rline</code>.)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">disp</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">1</span><span class="op">/</span><span class="va">mpg</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="va">disp</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>, <span class="va">mtcars</span>, pch<span class="op">=</span><span class="fl">20</span>,
     ylab <span class="op">=</span> <span class="st">"gal/mi"</span>,
     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Displacement"</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">a</span>, b<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">b</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-25-1.png" width="307.2"></p>
</div>
<div id="computing-a-confidence-interval" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-a-confidence-interval" class="anchor"></a>Computing a confidence interval</h2>
<p>Confidence intervals for the coefficients can be estimated using bootstrapping techniques. There are two approaches: resampling residuals and resampling x-y cases.</p>
<div id="resampling-the-model-residuals" class="section level3">
<h3 class="hasAnchor">
<a href="#resampling-the-model-residuals" class="anchor"></a>Resampling the model residuals</h3>
<p>Here, we fit the resistant line then extract its residuals. We then re-run the model many times by replacing the original y values with the <strong>modeled</strong> y values <strong>plus</strong> the resampled residuals to generate the confidence intervals.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span>  <span class="op">&lt;-</span> <span class="fl">599</span> <span class="co"># Set number of iterations</span>
<span class="va">M</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">neoplasms</span>, <span class="va">Temp</span>, <span class="va">Mortality</span><span class="op">)</span> <span class="co"># Fit the resistant line</span>
<span class="va">bt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Create empty bootstrap array</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span> <span class="co">#bootstrap loop</span>
  <span class="va">df.bt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">M</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">M</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">M</span><span class="op">$</span><span class="va">res</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="va">bt</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">df.bt</span>,<span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">$</span><span class="va">a</span>
  <span class="va">bt</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">df.bt</span>,<span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">$</span><span class="va">b</span>
<span class="op">}</span></code></pre></div>
<p>Now plot the distributions,</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"Intercept distribution"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"Slope distribution"</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
<p>and tabulate the 95% confidence interval.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span><span class="op">)</span> <span class="op">)</span>,
                     Slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">conf</span>
<span class="co">#&gt;                    5%      95%</span>
<span class="co">#&gt;  Intercept -78.815486 8.192291</span>
<span class="co">#&gt;  Slope       1.712624 3.562789</span></code></pre></div>
</div>
<div id="resampling-the-x-y-paired-values" class="section level3">
<h3 class="hasAnchor">
<a href="#resampling-the-x-y-paired-values" class="anchor"></a>Resampling the x-y paired values</h3>
<p>Here, we resample the x-y paired values (with replacement) then compute the resistant line each time.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span>  <span class="op">&lt;-</span> <span class="fl">599</span> <span class="co"># Set number of iterations</span>
<span class="va">bt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Create empty bootstrap array</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span> <span class="co">#bootstrap loop</span>
  <span class="va">recs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">neoplasms</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">df.bt</span> <span class="op">&lt;-</span> <span class="va">neoplasms</span><span class="op">[</span><span class="va">recs</span>,<span class="op">]</span>
  <span class="va">bt</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">df.bt</span>,<span class="va">Temp</span>,<span class="va">Mortality</span><span class="op">)</span><span class="op">$</span><span class="va">a</span>
  <span class="va">bt</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="../reference/eda_rline.html">eda_rline</a></span><span class="op">(</span><span class="va">df.bt</span>,<span class="va">Temp</span>,<span class="va">Mortality</span><span class="op">)</span><span class="op">$</span><span class="va">b</span>
<span class="op">}</span></code></pre></div>
<p>Now plot the distributions,</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"Intercept distribution"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"Slope distribution"</span><span class="op">)</span></code></pre></div>
<p><img src="RLine_files/figure-html/unnamed-chunk-30-1.png" width="576"></p>
<p>and tabulate the 95% confidence interval.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span><span class="op">)</span> <span class="op">)</span>,
                     Slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bt</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">conf</span>
<span class="co">#&gt;                     5%       95%</span>
<span class="co">#&gt;  Intercept -116.523077 12.429292</span>
<span class="co">#&gt;  Slope        1.643678  4.338462</span></code></pre></div>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ul>
<li>
<em>Applications, Basics and Computing of Exploratory Data Analysis</em>, P.F. Velleman and D.C. Hoaglin, 1981.<br>
</li>
<li>
<em>Understanding robust and exploratory data analysis</em>, D.C. Hoaglin, F. Mosteller and J.W. Tukey, 1983.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Manuel Gimond.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
